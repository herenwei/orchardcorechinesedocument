var WorkflowCanvas=function(){return function(t,n){var o=this;this.container=t,this.workflowType=n,this.minCanvasHeight=400,this.getActivityElements=function(){return $(o.container).find(".activity")},this.getDefaults=function(){return{Anchor:"Continuous",DragOptions:{cursor:"pointer",zIndex:2e3},EndpointStyles:[{fillStyle:"#225588"}],Endpoints:[["Dot",{radius:7}],["Blank"]],ConnectionOverlays:[["Arrow",{width:12,length:12,location:-5}]],ConnectorZIndex:5}},this.createJsPlumbInstance=function(){return jsPlumb.getInstance({DragOptions:{cursor:"pointer",zIndex:2e3},ConnectionOverlays:[["Arrow",{location:1,visible:!0,width:11,length:11}],["Label",{location:.5,id:"label",cssClass:"connection-label"}]],Container:o.container})},this.getEndpointColor=function(t){return t.isBlocking||t.isStart?"#7ab02c":t.isEvent?"#3a8acd":"#7ab02c"},this.getSourceEndpointOptions=function(t,n){var e=o.getEndpointColor(t);return{endpoint:"Dot",anchor:"Continuous",paintStyle:{stroke:e,fill:e,radius:7,strokeWidth:1},isSource:!0,connector:["Flowchart",{stub:[40,60],gap:0,cornerRadius:5,alwaysRespectStubs:!0}],connectorStyle:{strokeWidth:2,stroke:"#999999",joinstyle:"round",outlineStroke:"white",outlineWidth:2},hoverPaintStyle:{fill:"#216477",stroke:"#216477"},connectorHoverStyle:{strokeWidth:3,stroke:"#216477",outlineWidth:5,outlineStroke:"white"},connectorOverlays:[["Label",{location:[3,-1.5],cssClass:"endpointSourceLabel"}]],dragOptions:{},uuid:t.id+"-"+n.name,parameters:{outcome:n}}},this.getActivity=function(t,n){return void 0===n&&(n=null),n||(n=this.workflowType.activities),$.grep(n,function(n){return n.id===t})[0]},this.updateConnections=function(t){for(var n=o.workflowType.id,e=0,i=o.workflowType.transitions;e<i.length;e++){var r=i[e],a=r.sourceActivityId+"-"+r.sourceOutcomeName,s=t.getEndpoint(a),c="activity-"+n+"-"+r.destinationActivityId;t.connect({source:s,target:c})}},this.updateCanvasHeight=function(){for(var t=$(this.container),n=0,o=0,e=0,i=t.find(".activity").toArray();e<i.length;e++){var r=i[e],a=$(r),s=a.position().top;s>n&&(n=s,o=a.height())}var c=n+o;c-(n+o)<=100&&(c+=100),t.height(Math.max(this.minCanvasHeight,c))}}}(),__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var o in n)n.hasOwnProperty(o)&&(t[o]=n[o])};return function(n,o){function e(){this.constructor=n}t(n,o),n.prototype=null===o?Object.create(o):(e.prototype=o.prototype,new e)}}(),WorkflowViewer=function(t){function n(n,o){var e=t.call(this,n,o)||this;e.container=n,e.workflowType=o,e.getEndpointColor=function(t){return t.isBlocking?"#7ab02c":t.isEvent?"#3a8acd":"#7ab02c"};return jsPlumb.ready(function(){jsPlumb.importDefaults(e.getDefaults());var t=e.createJsPlumbInstance();t.bind("connection",function(t,n){var o=t.connection,e=o.getParameters().outcome;o.getOverlay("label").setLabel(e.displayName)});var n=e.getActivityElements();t.batch(function(){e.workflowType.id;n.each(function(n,o){var i=$(o).data("activity-id"),r=e.getActivity(i);t.makeTarget(o,{dropOptions:{hoverClass:"hover"},anchor:"Continuous",endpoint:["Blank",{radius:8}]});for(var a=0,s=r.outcomes;a<s.length;a++){var c=s[a],l=e.getSourceEndpointOptions(r,c);t.addEndpoint(o,{connectorOverlays:[["Label",{label:c.displayName,cssClass:"connection-label"}]]},l)}}),e.updateConnections(t),(n=e.getActivityElements()).show(),e.updateCanvasHeight()}),e.jsPlumbInstance=t}),e}return __extends(n,t),n}(WorkflowCanvas);$.fn.workflowViewer=function(){return this.each(function(t,n){var o=$(n),e=o.data("workflow-type");o.data("workflowViewer",new WorkflowViewer(n,e))}),this},$(document).ready(function(){$(".workflow-canvas").workflowViewer().data("workflowViewer")});
